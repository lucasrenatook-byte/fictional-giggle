<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RIFA EM PROL DA FORMATURA DO ENZO GABRIEL</title>
  <style>
    body {font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0;}
    header {background: #1e88e5; color: white; padding: 15px; text-align: center; position: relative;}
    .container {max-width: 900px; margin: auto; background: white; padding: 20px; box-shadow: 0 0 10px #ccc;}
    .numbers {display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;}
    .number {width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; border-radius: 5px; color: white; cursor: pointer;}
    .available {background: green;}
    .reserved {background: gray;}
    .sold {background: red;}
    #adminPanel, #loginPanel, #pixArea {display: none;}
    button {background: #1e88e5; color: white; border: none; padding: 10px 15px; margin: 5px; cursor: pointer; border-radius: 5px;}
    input, select {margin: 5px; padding: 8px; width: 95%;}
    #adminLoginBtn {position: absolute; right: 20px; top: 15px; background: #1565c0; padding: 5px 10px; font-size: 14px;}
    #summary {margin-top: 10px;}
  </style>
</head>
<body>

<header>
  <h1>RIFA EM PROL DA FORMATURA DO ENZO GABRIEL</h1>
  <button id="adminLoginBtn">Admin</button>
</header>

<div class="container">
  <h3>Selecione seus n√∫meros - R$10,00 cada</h3>
  <div class="numbers" id="numbersGrid"></div>

  <div id="userForm">
    <h4>Seus Dados</h4>
    <input type="text" id="nome" placeholder="Nome completo">
    <input type="email" id="email" placeholder="E-mail">
    <input type="text" id="whatsapp" placeholder="WhatsApp">
    <input type="text" id="cpf" placeholder="CPF (opcional)">
    
    <div id="summary">
      <p><strong>N√∫meros Selecionados:</strong> <span id="qtdSelecionados">0</span></p>
      <p><strong>Total a Pagar:</strong> R$ <span id="valorTotal">0.00</span></p>
    </div>

    <button id="confirmarBtn">Confirmar Reserva</button>
  </div>

  <div id="pixArea">
    <h4>Efetue o pagamento</h4>
    <p><strong>Chave Pix:</strong> <span id="pixKey">---</span></p>
    <p><strong>Recebedor:</strong> <span id="pixName">---</span></p>
    <p><strong>Banco:</strong> <span id="pixBank">---</span></p>
    <button id="copyPix">Copiar Pix</button>
    <button id="notifyPaid">J√° efetuei o pagamento</button>
  </div>
</div>

<div id="loginPanel" class="container">
  <h3>Login do Administrador</h3>
  <input type="text" id="adminUser" placeholder="Usu√°rio">
  <input type="password" id="adminPass" placeholder="Senha">
  <button id="loginBtn">Entrar</button>
</div>

<div id="adminPanel" class="container">
  <h2>Painel do Administrador</h2>

  <h4>Configura√ß√µes do Pix</h4>
  <input id="adminPix" placeholder="Chave Pix" disabled>
  <input id="adminPixName" placeholder="Nome do recebedor" disabled>
  <input id="adminPixBank" placeholder="Banco recebedor" disabled>
  <button id="enableEditPix">Editar</button>
  <button id="saveSettings" disabled>Salvar Configura√ß√µes</button>

  <h4>Status</h4>
  <p><strong>Vendidos:</strong> <span id="soldCount">0</span> |
     <strong>Reservados:</strong> <span id="reservedCount">0</span> |
     <strong>Dispon√≠veis:</strong> <span id="availableCount">300</span></p>

  <div id="reservasList"></div>
</div>

<script>
let selectedNumbers = [], adminLogged = false;

function updateResumo() {
  document.getElementById('qtdSelecionados').textContent = selectedNumbers.length;
  document.getElementById('valorTotal').textContent = (selectedNumbers.length * 10).toFixed(2);
}

function toggleNumber(div, n) {
  if (div.classList.contains('sold') || div.classList.contains('reserved')) return;

  if (selectedNumbers.includes(n)) {
    selectedNumbers = selectedNumbers.filter(x => x !== n);
    div.style.border = '';
  } else {
    selectedNumbers.push(n);
    div.style.border = '2px solid #000';
  }
  updateResumo();
}

// Gera os 300 n√∫meros
const grid = document.getElementById('numbersGrid');
for (let i = 1; i <= 300; i++) {
  const d = document.createElement('div');
  d.textContent = i;
  d.classList.add('number', 'available');
  d.onclick = () => toggleNumber(d, i);
  grid.appendChild(d);
}

// Bot√£o admin no topo
document.getElementById('adminLoginBtn').onclick = () => {
  document.getElementById('loginPanel').style.display = 'block';
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
};

// Login
document.getElementById('loginBtn').onclick = () => {
  const u = document.getElementById('adminUser').value;
  const p = document.getElementById('adminPass').value;
  if (u === 'admin' && p === 'admin123') {
    adminLogged = true;
    document.getElementById('loginPanel').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    loadPixSettings();
    updateReservasList();
  } else {
    alert('Login incorreto');
  }
};

document.getElementById('enableEditPix').onclick = () => {
  adminPix.disabled = false;
  adminPixName.disabled = false;
  adminPixBank.disabled = false;
  saveSettings.disabled = false;
};

document.getElementById('saveSettings').onclick = () => {
  localStorage.setItem('pix', adminPix.value);
  localStorage.setItem('pixName', adminPixName.value);
  localStorage.setItem('pixBank', adminPixBank.value);
  alert('Configura√ß√µes salvas!');
  loadPixSettings();
  adminPix.disabled = true;
  adminPixName.disabled = true;
  adminPixBank.disabled = true;
  saveSettings.disabled = true;
};

function loadPixSettings() {
  pixKey.textContent = localStorage.getItem('pix') || '---';
  pixName.textContent = localStorage.getItem('pixName') || '---';
  pixBank.textContent = localStorage.getItem('pixBank') || '---';
  adminPix.value = localStorage.getItem('pix') || '';
  adminPixName.value = localStorage.getItem('pixName') || '';
  adminPixBank.value = localStorage.getItem('pixBank') || '';
}

// Cliente confirma reserva
confirmarBtn.addEventListener('click', () => {
  if (!nome.value.trim() || !email.value.trim() || !whatsapp.value.trim() || selectedNumbers.length === 0) return;

  const reservas = JSON.parse(localStorage.getItem('reservations') || '[]');
  reservas.push({
    nome: nome.value,
    email: email.value,
    wpp: whatsapp.value,
    cpf: cpf.value,
    numeros: selectedNumbers,
    status: 'reservado',
    time: Date.now()
  });
  localStorage.setItem('reservations', JSON.stringify(reservas));

  alert('N√∫meros reservados! Pague via Pix e confirme.');

  selectedNumbers.forEach(n => {
    const d = document.querySelectorAll('.number')[n - 1];
    d.classList.remove('available');
    d.classList.add('reserved');
    d.style.border = '';
  });

  selectedNumbers = [];
  updateResumo();
  updateReservasList();
  document.getElementById('pixArea').style.display = 'block';
});

// Atualiza reservas no painel admin
function updateReservasList() {
  if (!adminLogged) return;
  const list = reservasList;
  const reservas = JSON.parse(localStorage.getItem('reservations') || '[]');
  list.innerHTML = '';

  reservas.forEach((r, i) => {
    const d = document.createElement('div');
    d.style.border = '1px solid #ccc';
    d.style.padding = '10px';
    d.style.marginBottom = '5px';

    const statusLabel = r.status === 'vendido' ? 'üí∞ Pago' :
                        r.status === 'reservado' ? '‚è≥ Reservado' :
                        r.status === 'estornado' ? '‚ö†Ô∏è Estornado' : '‚Äî';

    d.innerHTML = `
      <p><strong>${r.nome}</strong> (${r.email})</p>
      <p><strong>WhatsApp:</strong> ${r.wpp}</p>
      <p><strong>N√∫meros:</strong> ${r.numeros.join(', ')}</p>
      <p><strong>Status:</strong> ${statusLabel}</p>
      <p><small>${new Date(r.time).toLocaleString()}</small></p>
      ${r.status === 'reservado' ? `<button onclick="confirmPayment(${i})">Confirmar</button>` : ''}
      ${r.status === 'vendido' ? `<button onclick="estornarPagamento(${i})">Estornar</button>` : ''}
      <button onclick="deleteReservation(${i})">Excluir</button>
    `;
    list.appendChild(d);
  });
}

// Confirma pagamento
function confirmPayment(i) {
  const reservas = JSON.parse(localStorage.getItem('reservations') || '[]');
  const r = reservas[i];
  r.numeros.forEach(n => {
    const d = document.querySelectorAll('.number')[n - 1];
    d.classList.remove('reserved');
    d.classList.add('sold');
  });
  r.status = 'vendido';
  localStorage.setItem('reservations', JSON.stringify(reservas));
  updateReservasList();
  updateCounts();
}

// Estornar
function estornarPagamento(i) {
  const reservas = JSON.parse(localStorage.getItem('reservations') || '[]');
  const r = reservas[i];
  r.numeros.forEach(n => {
    const d = document.querySelectorAll('.number')[n - 1];
    d.classList.remove('sold');
    d.classList.add('available');
  });
  r.status = 'estornado';
  localStorage.setItem('reservations', JSON.stringify(reservas));
  updateReservasList();
  updateCounts();
}

function deleteReservation(i) {
  const reservas = JSON.parse(localStorage.getItem('reservations') || '[]');
  reservas.splice(i, 1);
  localStorage.setItem('reservations', JSON.stringify(reservas));
  updateReservasList();
  updateCounts();
}

function updateCounts() {
  const all = document.querySelectorAll('.number');
  let vendidos = 0, reservados = 0, disponiveis = 0;

  all.forEach(el => {
    if (el.classList.contains('sold')) vendidos++;
    else if (el.classList.contains('reserved')) reservados++;
    else disponiveis++;
  });

  soldCount.textContent = vendidos;
  reservedCount.textContent = reservados;
  availableCount.textContent = disponiveis;
}

function autoExpireReservations() {
  const saved = JSON.parse(localStorage.getItem('reservations') || '[]');
  const now = Date.now();
  const atualizadas = saved.filter(r => now - r.time < 12 * 60 * 60 * 1000 || r.status !== 'reservado');
  localStorage.setItem('reservations', JSON.stringify(atualizadas));
  updateReservasList();
  updateCounts();
}

document.getElementById('copyPix').onclick = () => {
  navigator.clipboard.writeText(document.getElementById('pixKey').textContent);
  alert('Chave Pix copiada!');
};

document.getElementById('notifyPaid').onclick = () => {
  alert('Obrigado! Sua reserva ser√° confirmada em breve.');
  document.getElementById('pixArea').style.display = 'none';
};

setInterval(updateCounts, 2000);
setInterval(autoExpireReservations, 60000);
setInterval(() => { if (adminLogged) updateReservasList(); }, 5000);
loadPixSettings();
</script>

</body>
</html>
