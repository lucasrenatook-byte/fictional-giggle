<script>
  let adminPassword = "admin123";
  let masterPassword = "master123";

  const grid = document.getElementById("numbersGrid");
  let selectedNumbers = [];
  let reservas = JSON.parse(localStorage.getItem("reservas") || "[]");
  let pix = localStorage.getItem("pix") || "";
  let pixName = localStorage.getItem("pixName") || "";
  let pixBank = localStorage.getItem("pixBank") || "";

  // Criar os 400 números
  for (let i = 1; i <= 400; i++) {
    const div = document.createElement("div");
    div.className = "number available";
    div.innerText = i;
    div.onclick = () => toggleNumber(i, div);
    grid.appendChild(div);
  }

  // Alternar seleção de números
  function toggleNumber(num, div) {
    if (div.classList.contains("sold") || div.classList.contains("reserved")) return;

    if (selectedNumbers.includes(num)) {
      selectedNumbers = selectedNumbers.filter(n => n !== num);
      div.style.border = "";
    } else {
      selectedNumbers.push(num);
      div.style.border = "2px solid black";
    }

    document.getElementById("selectedCount").innerText = selectedNumbers.length;
    document.getElementById("totalPrice").innerText = (selectedNumbers.length * 10).toFixed(2);
  }

  // Confirmar reserva
  function confirmarReserva() {
    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const cpf = document.getElementById("cpf").value.trim();

    if (!nome || !email || !whatsapp || selectedNumbers.length === 0) {
      alert("Preencha todos os campos e selecione os números.");
      return;
    }

    reservas.push({
      nome,
      email,
      whatsapp,
      cpf,
      numeros: selectedNumbers,
      status: "reservado",
      pagamentoConfirmado: false
    });

    localStorage.setItem("reservas", JSON.stringify(reservas));

    // Atualiza a interface
    alert("Reserva registrada com sucesso! Efetue o pagamento.");
    selectedNumbers.forEach(num => {
      const numberDiv = Array.from(grid.getElementsByClassName("number")).find(div => parseInt(div.innerText) === num);
      numberDiv.classList.remove("available");
      numberDiv.classList.add("reserved");
    });
    selectedNumbers = [];
    location.reload();
  }

  // Admin login
  function loginAdmin() {
    const user = document.getElementById("adminUser").value;
    const pass = document.getElementById("adminPass").value;

    if ((user === "admin" && pass === adminPassword) || (user === "master" && pass === masterPassword)) {
      document.getElementById("adminPanel").style.display = "block";
      document.getElementById("loginPanel").style.display = "none";
      carregarReservasAdmin();
    } else {
      alert("Login incorreto.");
    }
  }

  // Carregar reservas para Admin
  function carregarReservasAdmin() {
    const lista = document.getElementById("listaReservas");
    lista.innerHTML = "";
    reservas.forEach((r, i) => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${r.nome}</strong> - Números: ${r.numeros.join(", ")} - 
      ${r.status} - <button onclick="confirmarPagamento(${i})">Confirmar Pagamento</button> 
      ${r.status === "reservado" ? `<button onclick="aprovarReserva(${i})">Aprovar</button>` : ""}`;
      lista.appendChild(li);
    });
  }

  // Confirmar pagamento
  function confirmarPagamento(index) {
    reservas[index].pagamentoConfirmado = true;
    reservas[index].status = "pago";
    localStorage.setItem("reservas", JSON.stringify(reservas));
    carregarReservasAdmin();
  }

  // Aprovar reserva
  function aprovarReserva(index) {
    reservas[index].status = "reservado";
    localStorage.setItem("reservas", JSON.stringify(reservas));
    carregarReservasAdmin();
  }
</script>
