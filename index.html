<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RIFA EM PROL DA FORMATURA DO ENZO GABRIEL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1e88e5;
      color: white;
      padding: 15px;
      text-align: center;
      position: relative;
    }
    .header-login {
      position: absolute;
      right: 20px;
      top: 10px;
      color: white;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px #ccc;
    }
    .numbers {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
    }
    .number {
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      text-align: center;
    }
    .available {
      background: green;
    }
    .reserved {
      background: gray;
    }
    .sold {
      background: red;
    }
    button {
      background: #1e88e5;
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
    }
    input {
      margin: 5px;
      padding: 8px;
      width: 95%;
    }
    .alert-message {
      background-color: #ffcccb;
      color: #b00000;
      padding: 10px;
      font-weight: bold;
      text-align: center;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-weight: bold;
      text-transform: uppercase;
      color: #000;
    }
  </style>
</head>
<body>
  <header>
    <h1>RIFA EM PROL DA FORMATURA DO ENZO GABRIEL</h1>
    <div class="header-login">
      <button onclick="showLoginPanel()">Login Admin</button>
    </div>
  </header>

  <div class="container">
    <p><strong>Selecione seus números - R$10,00 cada</strong></p>
    <div class="numbers" id="numbersGrid"></div>

    <div class="alert-message">
      TODAS AS RESERVAS SÓ SERÃO ACEITAS MEDIANTE CADASTRO E PIX SEREM DA MESMA TITULARIDADE. FIQUE ATENTO. SORTEIO SERÁ REALIZADO APÓS TODAS AS COTAS VENDIDAS
    </div>

    <div id="userForm">
      <p><strong>Seus Dados</strong></p>
      <input type="text" id="nome" placeholder="Nome completo" />
      <input type="email" id="email" placeholder="E-mail" />
      <input type="text" id="whatsapp" placeholder="WhatsApp" />
      <input type="text" id="cpf" placeholder="CPF (opcional)" />
      <p>
        <strong>Números selecionados: </strong><span id="selectedCount">0</span><br />
        <strong>Valor total: </strong>R$ <span id="totalPrice">0,00</span>
      </p>
      <button id="confirmarBtn">Confirmar Reserva</button>
    </div>

    <div id="pixArea" style="display:none;">
      <p><strong>Efetue o pagamento</strong></p>
      <p><strong>Chave Pix:</strong> <span id="pixKey">---</span></p>
      <p><strong>Recebedor:</strong> <span id="pixName">---</span></p>
      <p><strong>Banco:</strong> <span id="pixBank">---</span></p>
      <button id="copyPix" onclick="copyPix()">Copiar Pix</button>
      <button id="notifyPaid" onclick="notifyPayment()">Já efetuei o pagamento</button>
    </div>
    <!-- Painel de Solicitação de Estorno do Cliente -->
    <div id="solicitarEstornoArea" style="margin-top:20px;">
      <p><strong>Deseja cancelar sua reserva?</strong></p>
      <button onclick="solicitarEstorno()">Solicitar Estorno</button>
    </div>
  </div>

  <!-- Login Admin -->
  <div class="container" id="loginPanel" style="display: none;">
    <h2>Login do Administrador</h2>
    <input type="text" id="adminUser" placeholder="Usuário" />
    <input type="password" id="adminPass" placeholder="Senha" />
    <button onclick="loginAdmin()">Entrar</button>
    <button onclick="showChangePassword()">Alterar Senha</button>
  </div>

  <!-- Painel Admin -->
  <div class="container" id="adminPanel" style="display: none;">
    <h2>Painel do Administrador</h2>

    <p><strong>Chave Pix:</strong> <input id="adminPix" placeholder="Chave Pix" /></p>
    <p><strong>Nome:</strong> <input id="adminPixName" placeholder="Nome do recebedor" /></p>
    <p><strong>Banco:</strong> <input id="adminPixBank" placeholder="Banco" /></p>
    <button onclick="salvarPix()">Salvar Pix</button>

    <h3>Reservas</h3>
    <ul id="listaReservas"></ul>
    <button onclick="showChangePassword()">Alterar Senha Admin</button>
  </div>

  <!-- Alteração de Senha -->
  <div class="container" id="changePasswordPanel" style="display: none;">
    <h2>Alterar Senha</h2>
    <input type="password" id="newPassword" placeholder="Nova Senha" />
    <input type="password" id="confirmPassword" placeholder="Confirme a Senha" />
    <button onclick="alterarSenha()">Alterar Senha</button>
    <button onclick="cancelarAlteracao()">Cancelar</button>
  </div>

  <footer>
    QUALQUER DÚVIDA ENTRAR EM CONTATO NO WHATSAPP NO LINK A SEGUIR:  
    <a href="https://wa.me/+5581989681443" target="_blank">
      https://wa.me/+5581989681443
    </a>
  </footer>

  <script>
    let adminPassword = "admin123";
    let masterPassword = "master123";

    const grid = document.getElementById("numbersGrid");
    let selectedNumbers = [];

    // Criar os 400 números
    for (let i = 1; i <= 400; i++) {
      const div = document.createElement("div");
      div.className = "number available";
      div.innerText = i;
      div.onclick = () => toggleNumber(i, div);
      grid.appendChild(div);
    }

    function toggleNumber(num, div) {
      if (div.classList.contains("sold") || div.classList.contains("reserved")) return;

      if (selectedNumbers.includes(num)) {
        selectedNumbers = selectedNumbers.filter(n => n !== num);
        div.style.border = "";
      } else {
        selectedNumbers.push(num);
        div.style.border = "2px solid black";
      }

      document.getElementById("selectedCount").innerText = selectedNumbers.length;
      document.getElementById("totalPrice").innerText = (selectedNumbers.length * 10).toFixed(2);
    }

    function confirmarReserva() {
      const nome = document.getElementById("nome").value.trim();
      const email = document.getElementById("email").value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
      const cpf = document.getElementById("cpf").value.trim();

      if (!nome || !email || !whatsapp || selectedNumbers.length === 0) {
        alert("Preencha os dados e selecione pelo menos um número.");
        return;
      }

      const reservas = JSON.parse(localStorage.getItem("reservas") || "[]");
      reservas.push({
        nome,
        email,
        whatsapp,
        cpf,
        numeros: selectedNumbers,
        status: "reservado",
        pagamentoConfirmado: false,
        solicitouEstorno: false
      });

      localStorage.setItem("reservas", JSON.stringify(reservas));
      alert("Reserva registrada. Efetue o Pix e aguarde confirmação.");
      selectedNumbers = [];
      location.reload();
    }

    function solicitarEstorno() {
      const email = prompt("Digite seu e-mail de cadastro para solicitar estorno:");
      if (!email) return;

      const reservas = JSON.parse(localStorage.getItem("reservas") || "[]");
      let alterou = false;

      reservas.forEach(r => {
        if (r.email === email && r.pagamentoConfirmado) {
          r.solicitouEstorno = true;
          alterou = true;
        }
      });

      if (alterou) {
        localStorage.setItem("reservas", JSON.stringify(reservas));
        alert("Solicitação de estorno enviada. Aguarde o administrador.");
      } else {
        alert("Nenhuma reserva encontrada com este e-mail ou ainda não confirmada.");
      }
    }

    function loginAdmin() {
      const user = document.getElementById("adminUser").value;
      const pass = document.getElementById("adminPass").value;

      if ((user === "admin" && pass === adminPassword) || (user === "master" && pass === masterPassword)) {
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("loginPanel").style.display = "none";
        carregarReservasAdmin();
      } else {
        alert("Login incorreto.");
      }
    }

    function carregarReservasAdmin() {
      const lista = document.getElementById("listaReservas");
      const reservas = JSON.parse(localStorage.getItem("reservas") || "[]");

      if (reservas.length === 0) {
        lista.innerHTML = "<li>Nenhuma reserva.</li>";
        return;
      }

      lista.innerHTML = "";
      reservas.forEach((r, i) => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${r.nome}</strong> - Números: ${r.numeros.join(", ")} - 
        ${r.pagamentoConfirmado ? "Pago" : "Reservado"} 
        ${r.solicitouEstorno ? " - <em>Solicitou estorno</em>" : ""}`;
        lista.appendChild(li);
      });
    }

    function salvarPix() {
      const pix = document.getElementById("adminPix").value.trim();
      const nome = document.getElementById("adminPixName").value.trim();
      const banco = document.getElementById("adminPixBank").value.trim();

      localStorage.setItem("pix", pix);
      localStorage.setItem("pixName", nome);
      localStorage.setItem("pixBank", banco);

      alert("Pix atualizado.");
    }

    function showLoginPanel() {
      document.getElementById("loginPanel").style.display = "block";
    }

    function copyPix() {
      const pixKey = document.getElementById("pixKey").innerText;
      navigator.clipboard.writeText(pixKey).then(() => {
        alert("Chave Pix copiada!");
      });
    }

    function notifyPayment() {
      alert("Pagamento confirmado. Aguardando validação do administrador.");
    }

    function showChangePassword() {
      document.getElementById("changePasswordPanel").style.display = "block";
    }

    function cancelarAlteracao() {
      document.getElementById("changePasswordPanel").style.display = "none";
    }

    function alterarSenha() {
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      if (newPassword !== confirmPassword) {
        alert("As senhas não coincidem.");
        return;
      }

      const user = document.getElementById("adminUser").value;
      if (user === "admin") {
        adminPassword = newPassword;
        alert("Senha do Admin alterada com sucesso.");
      } else if (user === "master") {
        masterPassword = newPassword;
        alert("Senha do Master alterada com sucesso.");
      }

      cancelarAlteracao();
    }

    window.onload = () => {
      const pix = localStorage.getItem("pix") || "";
      const pixName = localStorage.getItem("pixName") || "";
      const pixBank = localStorage.getItem("pixBank") || "";

      document.getElementById("pixKey").innerText = pix;
      document.getElementById("pixName").innerText = pixName;
      document.getElementById("pixBank").innerText = pixBank;
    };
  </script>
</body>
</html>
